# Enhanced Hypothesis Verification Template with Subagent Support
# This template includes subagent configuration for automated quality control

metadata:
  template_version: "2.0"
  created_date: "2025-07-31"
  description: "Template for social media sentiment vs stock price analysis with subagent support"

experiment:
  # Basic experiment information
  name: "{{EXPERIMENT_NAME}}"
  description: "{{EXPERIMENT_DESCRIPTION}}"
  hypothesis: "{{HYPOTHESIS_STATEMENT}}"
  
  # Subagent configuration (optional)
  subagents:
    # List subagents to use. If not specified, all relevant subagents will run automatically
    - data_validator      # Ensures data quality before analysis
    - market_context      # Researches market conditions during analysis period
    - statistical_analyzer # Performs rigorous statistical validation
    - report_generator    # Creates professional reports
    # - spec_researcher   # Runs quarterly to check for updates (auto-triggered)
  
  # Data sources configuration
  data_sources:
    social_media:
      platform: "{{PLATFORM}}"  # twitter, truth_social, reddit, etc.
      actor_id: "{{APIFY_ACTOR_ID}}"  # Apify actor ID for scraping
      accounts:  # List of accounts to monitor
        - "{{ACCOUNT_1}}"
        - "{{ACCOUNT_2}}"
      keywords:  # Keywords to filter posts
        - "{{KEYWORD_1}}"
        - "{{KEYWORD_2}}"
        - "{{KEYWORD_3}}"
      date_range:
        start: "{{START_DATE}}"  # YYYY-MM-DD or relative (e.g., "365_days_ago")
        end: "{{END_DATE}}"      # YYYY-MM-DD or "now"
      max_posts: {{MAX_POSTS}}  # Maximum number of posts to analyze
    
    market_data:
      provider: "alpaca"  # Currently only alpaca supported
      symbols:  # Stock symbols to track
        - symbol: "{{SYMBOL_1}}"
          name: "{{COMPANY_NAME_1}}"
        - symbol: "{{SYMBOL_2}}"
          name: "{{COMPANY_NAME_2}}"
      data_feed: "iex"  # iex, sip, etc.
      
  # Sentiment analysis configuration
  sentiment_analysis:
    llm_provider: "{{LLM_PROVIDER}}"  # openai, anthropic
    model: "{{MODEL_NAME}}"  # gpt-4-turbo-preview, gpt-3.5-turbo, claude-3-haiku, etc.
    temperature: {{TEMPERATURE}}  # 0.0 for consistency
    
    # Sentiment categories
    categories:
      - name: "BULLISH"
        description: "{{BULLISH_DESCRIPTION}}"
      - name: "BEARISH" 
        description: "{{BEARISH_DESCRIPTION}}"
      - name: "NEUTRAL"
        description: "{{NEUTRAL_DESCRIPTION}}"
    
    # Custom prompt template (optional)
    custom_prompt: |
      {{CUSTOM_PROMPT_TEMPLATE}}
  
  # Analysis configuration
  analysis:
    # Time intervals to measure impact (in hours)
    time_intervals: [{{INTERVAL_1}}, {{INTERVAL_2}}, {{INTERVAL_3}}, {{INTERVAL_4}}]
    
    # Statistical rigor level (affects subagent behavior)
    statistical_rigor: "{{RIGOR_LEVEL}}"  # basic, standard, academic
    
    # Additional conditions to analyze
    conditions:
      - name: "market_hours"
        description: "Whether posted during market hours"
        enabled: {{ANALYZE_MARKET_HOURS}}
      
      - name: "engagement_level"
        description: "Post engagement metrics"
        enabled: {{ANALYZE_ENGAGEMENT}}
        thresholds:
          viral: {{VIRAL_THRESHOLD}}
          high: {{HIGH_THRESHOLD}}
          medium: {{MEDIUM_THRESHOLD}}
      
      - name: "custom_condition"
        description: "{{CUSTOM_CONDITION_DESCRIPTION}}"
        enabled: {{CUSTOM_CONDITION_ENABLED}}
        implementation: "{{CUSTOM_CONDITION_CODE}}"
  
  # Output configuration
  output:
    reports:
      - type: "markdown"
        filename: "{{REPORT_FILENAME}}.md"
        style: "{{REPORT_STYLE}}"  # standard, academic, executive, publication
        include_sections:
          - sentiment_distribution
          - price_impact_summary
          - statistical_analysis
          - top_impact_posts
          - market_hours_analysis
          - engagement_analysis
          - key_findings
          - methodology
          - data_quality_report     # From data_validator subagent
          - market_context_summary  # From market_context subagent
          - statistical_validation  # From statistical_analyzer subagent
      
      # Additional report formats (optional)
      - type: "pdf"
        filename: "{{REPORT_FILENAME}}.pdf"
        style: "academic"
        enabled: {{GENERATE_PDF}}
      
      - type: "html"
        filename: "{{REPORT_FILENAME}}.html"
        style: "interactive"
        enabled: {{GENERATE_HTML}}
    
    visualizations:
      - type: "sentiment_overview"
        filename: "{{VIZ_PREFIX}}_sentiment_overview.png"
      - type: "price_timeline"
        filename: "{{VIZ_PREFIX}}_price_timeline.png"
      - type: "engagement_impact"
        filename: "{{VIZ_PREFIX}}_engagement_impact.png"
      - type: "price_distributions"
        filename: "{{VIZ_PREFIX}}_price_distributions.png"
      - type: "correlation_matrix"       # From statistical_analyzer
        filename: "{{VIZ_PREFIX}}_correlations.png"
      - type: "market_context_overlay"   # From market_context
        filename: "{{VIZ_PREFIX}}_market_context.png"
    
    data_exports:
      - type: "csv"
        filename: "{{DATA_PREFIX}}_analysis.csv"
      - type: "json"
        filename: "{{DATA_PREFIX}}_raw_posts.json"
      - type: "statistical_output"  # From statistical_analyzer
        filename: "{{DATA_PREFIX}}_statistical_results.json"

# Validation rules
validation:
  min_posts_required: {{MIN_POSTS}}
  min_confidence_threshold: {{MIN_CONFIDENCE}}
  data_quality_threshold: {{DATA_QUALITY_THRESHOLD}}  # For data_validator subagent
  required_env_vars:
    - "APIFY_API_KEY"
    - "ALPACA_API_KEY"
    - "ALPACA_SECRET_KEY"
    - "OPENAI_API_KEY"
    - "ANTHROPIC_API_KEY"

# Subagent-specific configuration (optional overrides)
subagent_config:
  data_validator:
    strict_mode: {{STRICT_VALIDATION}}
    check_duplicates: true
    check_outliers: true
    cross_reference_threshold: 0.9
  
  market_context:
    include_news: true
    include_sector_analysis: true
    confounding_window_days: 7
  
  statistical_analyzer:
    confidence_level: 0.95
    use_bootstrap: true
    bootstrap_iterations: 1000
    multiple_testing_correction: "bonferroni"
  
  report_generator:
    include_executive_summary: true
    max_pages: {{MAX_REPORT_PAGES}}
    visualization_dpi: 300
  
  spec_researcher:
    check_frequency_days: 90
    alert_on_deprecations: true
    suggest_alternatives: true